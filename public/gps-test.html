<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë—ã—Å—Ç—Ä—ã–π GPS —Ç–µ—Å—Ç</title>
    <!-- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è GPS -->
    <meta http-equiv="Permissions-Policy" content="geolocation=(self)" />
    <meta http-equiv="Feature-Policy" content="geolocation 'self'" />
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; margin: 10px 0; font-size: 16px; }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è –ë—ã—Å—Ç—Ä—ã–π GPS —Ç–µ—Å—Ç –¥–ª—è "–ó–µ–º–ª–µ–º–µ—Ä"</h1>
    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É GPS –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</p>
    
    <button onclick="testGPS()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å GPS</button>
    <button onclick="testPersistentGPS()">üìç –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å GPS</button>
    <button onclick="stopGPS()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
    
    <div id="results"></div>
    <div id="coords"></div>
    
    <script>
        let watchId = null;
        let gpsCount = 0;
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            document.getElementById('results').prepend(div);
        }
        
        function testGPS() {
            log('–ó–∞–ø—Ä–æ—Å GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç...');
            
            if (!navigator.geolocation) {
                log('‚ùå GPS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º', 'error');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    log(`‚úÖ GPS –ø–æ–ª—É—á–µ–Ω: ${latitude.toFixed(6)}, ${longitude.toFixed(6)} (¬±${accuracy.toFixed(0)}–º)`, 'success');
                },
                (error) => {
                    log(`‚ùå –û—à–∏–±–∫–∞ GPS: ${error.message}`, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }
        
        function testPersistentGPS() {
            if (watchId) {
                log('‚ö†Ô∏è GPS —É–∂–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è');
                return;
            }
            
            log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ GPS...');
            gpsCount = 0;
            
            watchId = navigator.geolocation.watchPosition(
                (position) => {
                    gpsCount++;
                    const { latitude, longitude, accuracy } = position.coords;
                    document.getElementById('coords').innerHTML = `
                        <h3>üìç –¢–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ #${gpsCount})</h3>
                        <p><strong>–®–∏—Ä–æ—Ç–∞:</strong> ${latitude.toFixed(6)}</p>
                        <p><strong>–î–æ–ª–≥–æ—Ç–∞:</strong> ${longitude.toFixed(6)}</p>
                        <p><strong>–¢–æ—á–Ω–æ—Å—Ç—å:</strong> ¬±${accuracy.toFixed(0)} –º–µ—Ç—Ä–æ–≤</p>
                    `;
                    log(`üîÑ GPS –æ–±–Ω–æ–≤–ª–µ–Ω #${gpsCount}: —Ç–æ—á–Ω–æ—Å—Ç—å ${accuracy.toFixed(0)}–º`, 'success');
                },
                (error) => {
                    log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è GPS: ${error.message}`, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 1000
                }
            );
        }
        
        function stopGPS() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
                log('‚èπÔ∏è –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ GPS –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                document.getElementById('coords').innerHTML = '';
            } else {
                log('‚ö†Ô∏è GPS –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            if (navigator.geolocation) {
                log('‚úÖ Geolocation API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'success');
            } else {
                log('‚ùå Geolocation API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
            }
        };
    </script>
</body>
</html>
