<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ó–µ–º–ª–µ–º–µ—Ä - –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .gps-status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .gps-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
            font-weight: bold;
        }
        
        .btn-primary {
            background: #28a745;
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .coordinates {
            background: rgba(40, 167, 69, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .accuracy {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 10px;
        }
        
        .accuracy.good { background: #28a745; }
        .accuracy.ok { background: #ffc107; color: #000; }
        .accuracy.bad { background: #dc3545; }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .control-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .add-marker {
            background: #007bff;
            color: white;
            grid-column: 1 / -1;
        }
        
        .calculate {
            background: #28a745;
            color: white;
        }
        
        .clear {
            background: #dc3545;
            color: white;
        }
        
        .results {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .markers-list {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .marker-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 6px;
            margin: 5px 0;
            font-size: 12px;
            font-family: monospace;
        }
        
        .status {
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 12px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìç –ó–µ–º–ª–µ–º–µ—Ä GPS</h1>
            <p>–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –∑–µ–º–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤</p>
        </div>
        
        <div class="gps-status">
            <div class="status">
                <strong>GPS –°—Ç–∞—Ç—É—Å:</strong> <span id="gpsStatus">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</span>
            </div>
            
            <div class="gps-buttons">
                <button class="btn btn-primary" onclick="getAccurateGPS()">
                    üéØ –¢–æ—á–Ω—ã–π GPS
                </button>
                <button class="btn btn-secondary" onclick="getBasicGPS()">
                    üì° –ë–∞–∑–æ–≤—ã–π GPS
                </button>
            </div>
            
            <div id="coordinates" class="coordinates hidden">
                üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <span id="coordsText">–Ω–µ –ø–æ–ª—É—á–µ–Ω—ã</span>
                <span id="accuracy" class="accuracy"></span>
            </div>
            
            <div id="warning" class="warning hidden">
                ‚ö†Ô∏è –¢–æ—á–Ω–æ—Å—Ç—å GPS –æ—á–µ–Ω—å –Ω–∏–∑–∫–∞—è. –î–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
                <br>‚Ä¢ –í—ã–π–¥–∏—Ç–µ –Ω–∞ —É–ª–∏—Ü—É –∏–ª–∏ –ø–æ–¥–æ–π–¥–∏—Ç–µ –∫ –æ–∫–Ω—É
                <br>‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ GPS –≤–∫–ª—é—á–µ–Ω –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
            </div>
        </div>
        
        <div class="controls">
            <button class="control-btn add-marker" onclick="addMarker()" id="addBtn" disabled>
                üìç –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É
            </button>
            <button class="control-btn calculate" onclick="calculateArea()" id="calcBtn" disabled>
                üìê –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
            </button>
            <button class="control-btn clear" onclick="clearMarkers()" id="clearBtn" disabled>
                üßπ –û—á–∏—Å—Ç–∏—Ç—å
            </button>
        </div>
        
        <div id="results" class="results">
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
            <div id="areaResults"></div>
        </div>
        
        <div id="markersList" class="markers-list hidden">
            <h3>üìç –¢–æ—á–∫–∏ (<span id="markerCount">0</span>):</h3>
            <div id="markersContainer"></div>
        </div>
    </div>

    <script>
        let currentLocation = null;
        let markers = [];
        let gpsAccuracy = null;
        
        function updateStatus(message) {
            document.getElementById('gpsStatus').textContent = message;
        }
        
        function updateCoordinates(lat, lng, accuracy) {
            currentLocation = { lat, lng };
            gpsAccuracy = accuracy;
            
            document.getElementById('coordsText').textContent = 
                `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            
            const accuracyEl = document.getElementById('accuracy');
            accuracyEl.textContent = `¬±${accuracy.toFixed(0)}–º`;
            
            if (accuracy <= 10) {
                accuracyEl.className = 'accuracy good';
            } else if (accuracy <= 100) {
                accuracyEl.className = 'accuracy ok';
            } else {
                accuracyEl.className = 'accuracy bad';
            }
            
            document.getElementById('coordinates').classList.remove('hidden');
            document.getElementById('addBtn').disabled = false;
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–ª–æ—Ö–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
            if (accuracy > 1000) {
                document.getElementById('warning').classList.remove('hidden');
            } else {
                document.getElementById('warning').classList.add('hidden');
            }
        }
        
        function getAccurateGPS() {
            if (!navigator.geolocation) {
                updateStatus('GPS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                return;
            }
            
            updateStatus('–ü–æ–∏—Å–∫ —Ç–æ—á–Ω–æ–≥–æ GPS...');
            
            const options = {
                enableHighAccuracy: true,
                timeout: 60000,
                maximumAge: 0
            };
            
            let attempts = 0;
            const maxAttempts = 5;
            let bestAccuracy = Infinity;
            
            function tryGPS() {
                attempts++;
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude, accuracy } = position.coords;
                        
                        if (accuracy < bestAccuracy) {
                            bestAccuracy = accuracy;
                            updateCoordinates(latitude, longitude, accuracy);
                        }
                        
                        if (accuracy <= 10 || attempts >= maxAttempts) {
                            updateStatus('GPS –ø–æ–ª—É—á–µ–Ω');
                            return;
                        }
                        
                        updateStatus(`–£–ª—É—á—à–∞–µ–º —Ç–æ—á–Ω–æ—Å—Ç—å... (${attempts}/${maxAttempts})`);
                        setTimeout(tryGPS, 2000);
                    },
                    (error) => {
                        console.error('GPS Error:', error);
                        updateStatus('–û—à–∏–±–∫–∞ GPS');
                        
                        if (attempts < maxAttempts) {
                            setTimeout(tryGPS, 2000);
                        }
                    },
                    options
                );
            }
            
            tryGPS();
        }
        
        function getBasicGPS() {
            if (!navigator.geolocation) {
                updateStatus('GPS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                return;
            }
            
            updateStatus('–ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ GPS...');
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    updateCoordinates(latitude, longitude, accuracy);
                    updateStatus('GPS –ø–æ–ª—É—á–µ–Ω');
                },
                (error) => {
                    console.error('GPS Error:', error);
                    updateStatus('–û—à–∏–±–∫–∞ GPS');
                },
                {
                    enableHighAccuracy: false,
                    timeout: 30000,
                    maximumAge: 300000
                }
            );
        }
        
        function addMarker() {
            if (!currentLocation) {
                alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã');
                return;
            }
            
            markers.push({
                lat: currentLocation.lat,
                lng: currentLocation.lng,
                accuracy: gpsAccuracy
            });
            
            updateMarkersList();
            updateButtons();
            
            // –í–∏–±—Ä–∞—Ü–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
        }
        
        function updateMarkersList() {
            const count = markers.length;
            document.getElementById('markerCount').textContent = count;
            
            if (count > 0) {
                document.getElementById('markersList').classList.remove('hidden');
                
                const container = document.getElementById('markersContainer');
                container.innerHTML = '';
                
                markers.forEach((marker, index) => {
                    const div = document.createElement('div');
                    div.className = 'marker-item';
                    div.innerHTML = `
                        –¢–æ—á–∫–∞ ${index + 1}: ${marker.lat.toFixed(6)}, ${marker.lng.toFixed(6)}
                        <br>–¢–æ—á–Ω–æ—Å—Ç—å: ¬±${marker.accuracy.toFixed(0)}–º
                    `;
                    container.appendChild(div);
                });
            } else {
                document.getElementById('markersList').classList.add('hidden');
            }
        }
        
        function updateButtons() {
            document.getElementById('calcBtn').disabled = markers.length < 3;
            document.getElementById('clearBtn').disabled = markers.length === 0;
        }
        
        function clearMarkers() {
            markers = [];
            updateMarkersList();
            updateButtons();
            document.getElementById('results').style.display = 'none';
        }
        
        function calculateArea() {
            if (markers.length < 3) {
                alert('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 —Ç–æ—á–∫–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–ª–æ—â–∞–¥–∏');
                return;
            }
            
            // –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–ª–æ—â–∞–¥–∏ –º–Ω–æ–≥–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
            let area = 0;
            const points = markers.map(m => [m.lat, m.lng]);
            
            for (let i = 0; i < points.length; i++) {
                const j = (i + 1) % points.length;
                area += points[i][0] * points[j][1];
                area -= points[j][0] * points[i][1];
            }
            
            area = Math.abs(area) / 2;
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –º–µ—Ç—Ä—ã (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)
            const areaSqMeters = area * 111139 * 111139;
            const areaSotkas = areaSqMeters / 100;
            
            document.getElementById('areaResults').innerHTML = `
                <div><strong>–ü–ª–æ—â–∞–¥—å:</strong> ${areaSqMeters.toFixed(1)} –º¬≤</div>
                <div><strong>–í —Å–æ—Ç–∫–∞—Ö:</strong> ${areaSotkas.toFixed(2)} —Å–æ—Ç–æ–∫</div>
                <div><strong>–¢–æ—á–µ–∫:</strong> ${markers.length}</div>
            `;
            
            document.getElementById('results').style.display = 'block';
            
            // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ GPS –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            if (navigator.geolocation) {
                updateStatus('GPS –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.');
            } else {
                updateStatus('GPS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —ç—Ç–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
            }
        });
    </script>
</body>
</html>
