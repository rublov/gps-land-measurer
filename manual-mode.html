<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–µ–º–ª–µ–º–µ—Ä - –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 400px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 20px; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .btn-primary { background: #2563eb; color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 14px; }
        .status-success { background: #d1fae5; color: #065f46; }
        .status-error { background: #fee2e2; color: #991b1b; }
        .status-info { background: #dbeafe; color: #1e40af; }
        .status-warning { background: #fef3c7; color: #92400e; }
        .input { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .coords { font-family: monospace; font-size: 12px; background: #f3f4f6; padding: 10px; border-radius: 5px; }
        .marker-list { max-height: 200px; overflow-y: auto; }
        .marker { padding: 8px; margin: 5px 0; background: #f3f4f6; border-radius: 5px; font-size: 12px; }
        .result { text-align: center; font-size: 18px; font-weight: bold; color: #059669; margin: 10px 0; }
        .map-demo { height: 200px; background: #e5e7eb; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #6b7280; margin: 10px 0; }
        .success { background: #f0fdf4; border: 1px solid #bbf7d0; padding: 15px; border-radius: 8px; color: #166534; }
        .warning { background: #fef2f2; border: 1px solid #fecaca; padding: 15px; border-radius: 8px; color: #991b1b; }
        .history-item { 
            background: #f8fafc; 
            border: 1px solid #e2e8f0; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px;
            position: relative;
        }
        .history-item h4 { margin: 0 0 10px 0; color: #1e293b; }
        .history-item .date { font-size: 12px; color: #64748b; margin-bottom: 8px; }
        .history-item .area { font-size: 16px; font-weight: bold; color: #059669; }
        .history-item .details { font-size: 12px; color: #475569; margin-top: 5px; }
        .history-item .actions { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
        }
        .history-item .actions button { 
            padding: 5px 10px; 
            margin-left: 5px; 
            border: none; 
            border-radius: 4px; 
            font-size: 12px; 
            cursor: pointer; 
        }
        .btn-restore { background: #10b981; color: white; }
        .btn-delete { background: #ef4444; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="card" style="margin-bottom: 15px;">
            <button onclick="goToHome()" class="btn btn-secondary">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>

        <div class="header">
            <h1>üó∫Ô∏è –ó–µ–º–ª–µ–º–µ—Ä</h1>
            <p>–†—É—á–Ω–æ–π —Ä–µ–∂–∏–º –∏–∑–º–µ—Ä–µ–Ω–∏—è</p>
        </div>

        <div class="warning">
            <strong>üìç –†–µ–∂–∏–º —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</strong><br>
            –ü–æ—Å–∫–æ–ª—å–∫—É GPS –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –º–µ—Å—Ç–∞.
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –º–µ—Å—Ç–∞ -->
        <div class="card">
            <h3>üèÉ –ë—ã—Å—Ç—Ä—ã–µ –º–µ—Å—Ç–∞</h3>
            <button id="moscowBtn" class="btn btn-primary">üèõÔ∏è –ú–æ—Å–∫–≤–∞ (–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å)</button>
            <button id="spbBtn" class="btn btn-primary">üè∞ –°–ü–± (–≠—Ä–º–∏—Ç–∞–∂)</button>
            <button id="nskBtn" class="btn btn-primary">üèôÔ∏è –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ (–¶–µ–Ω—Ç—Ä)</button>
            <button id="currentBtn" class="btn btn-warning">üìç –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å GPS</button>
        </div>

        <!-- –†—É—á–Ω–æ–π –≤–≤–æ–¥ -->
        <div class="card">
            <h3>‚úèÔ∏è –†—É—á–Ω–æ–π –≤–≤–æ–¥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</h3>
            <div id="coordsStatus" class="status status-info">–í–≤–µ–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Ä—É—á–Ω—É—é</div>
            <input type="number" id="latInput" class="input" placeholder="–®–∏—Ä–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 55.7558)" step="0.000001">
            <input type="number" id="lngInput" class="input" placeholder="–î–æ–ª–≥–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 37.6176)" step="0.000001">
            <button id="setManualBtn" class="btn btn-success">üìç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button>
            <div id="coords" class="coords"></div>
        </div>

        <!-- –ú–∞—Ä–∫–µ—Ä—ã -->
        <div class="card">
            <h3>üìç –ú–∞—Ä–∫–µ—Ä—ã (<span id="markerCount">0</span>)</h3>
            <div class="map-demo">
                <div>–ö–∞—Ä—Ç–∞ (–¥–µ–º–æ)<br>–ú–∞—Ä–∫–µ—Ä—ã: <span id="mapMarkerCount">0</span></div>
            </div>
            <button id="addMarkerBtn" class="btn btn-success" disabled>‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ä</button>
            <button id="clearBtn" class="btn btn-danger">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            <div id="markerList" class="marker-list"></div>
        </div>

        <!-- –†–∞—Å—á–µ—Ç—ã -->
        <div class="card">
            <h3>üìê –†–∞—Å—á–µ—Ç –ø–ª–æ—â–∞–¥–∏</h3>
            <button id="calculateBtn" class="btn btn-primary" disabled>üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
            <div id="result" class="result"></div>
        </div>

        <!-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ -->
        <div class="card">
            <h3>üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h3>
            <input type="text" id="saveName" class="input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—á–∞—Å—Ç–∫–∞">
            <button id="saveBtn" class="btn btn-success" disabled>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <div id="saveStatus"></div>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π -->
        <div class="card">
            <h3>üìã –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π (<span id="historyCount">0</span>)</h3>
            <button id="loadHistoryBtn" class="btn btn-primary">üìÇ –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ</button>
            <button id="clearHistoryBtn" class="btn btn-danger">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
            <button id="exportHistoryBtn" class="btn btn-secondary">üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            <div id="historyList" class="marker-list" style="display: none;"></div>
        </div>

        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
        <div class="card">
            <h3>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h3>
            <div style="font-size: 14px; line-height: 1.5;">
                <p><strong>1.</strong> –í—ã–±–µ—Ä–∏—Ç–µ –±—ã—Å—Ç—Ä–æ–µ –º–µ—Å—Ç–æ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Ä—É—á–Ω—É—é</p>
                <p><strong>2.</strong> –ù–∞–∂–º–∏—Ç–µ "‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ä" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏</p>
                <p><strong>3.</strong> –î–æ–±–∞–≤—å—Ç–µ –º–∏–Ω–∏–º—É–º 3 –º–∞—Ä–∫–µ—Ä–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–ª–æ—â–∞–¥–∏</p>
                <p><strong>4.</strong> –ù–∞–∂–º–∏—Ç–µ "üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</p>
                <p><strong>5.</strong> –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É—á–∞—Å—Ç–∫–∞</p>
            </div>
        </div>
    </div>

    <script>
        let currentLocation = null;
        let markers = [];
        let calculatedArea = 0;

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const coordsStatus = document.getElementById('coordsStatus');
        const coords = document.getElementById('coords');
        const latInput = document.getElementById('latInput');
        const lngInput = document.getElementById('lngInput');
        const addMarkerBtn = document.getElementById('addMarkerBtn');
        const clearBtn = document.getElementById('clearBtn');
        const calculateBtn = document.getElementById('calculateBtn');
        const saveBtn = document.getElementById('saveBtn');
        const markerCount = document.getElementById('markerCount');
        const mapMarkerCount = document.getElementById('mapMarkerCount');
        const markerList = document.getElementById('markerList');
        const result = document.getElementById('result');
        const saveName = document.getElementById('saveName');
        const saveStatus = document.getElementById('saveStatus');

        // –ò—Å—Ç–æ—Ä–∏—è
        const historyList = document.getElementById('historyList');
        const historyCount = document.getElementById('historyCount');

        // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞
        const places = {
            moscow: { name: '–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, –ú–æ—Å–∫–≤–∞', lat: 55.7558, lng: 37.6176 },
            spb: { name: '–≠—Ä–º–∏—Ç–∞–∂, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', lat: 59.9398, lng: 30.3146 },
            nsk: { name: '–¶–µ–Ω—Ç—Ä –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞', lat: 55.0084, lng: 82.9357 }
        };

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(text, type, element = coordsStatus) {
            element.className = `status status-${type}`;
            element.textContent = text;
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ
        function setPlace(place) {
            currentLocation = place;
            
            coords.innerHTML = `
                üìç ${place.name}<br>
                –®–∏—Ä–æ—Ç–∞: ${place.lat.toFixed(6)}<br>
                –î–æ–ª–≥–æ—Ç–∞: ${place.lng.toFixed(6)}<br>
                –ò—Å—Ç–æ—á–Ω–∏–∫: –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ
            `;
            
            latInput.value = place.lat;
            lngInput.value = place.lng;
            
            showStatus('‚úÖ –ú–µ—Å—Ç–æ –≤—ã–±—Ä–∞–Ω–æ', 'success');
            addMarkerBtn.disabled = false;
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Ä—É—á–Ω—É—é
        function setManualCoords() {
            const lat = parseFloat(latInput.value);
            const lng = parseFloat(lngInput.value);
            
            if (isNaN(lat) || isNaN(lng)) {
                showStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã', 'error');
                return;
            }
            
            if (lat < -90 || lat > 90) {
                showStatus('‚ùå –®–∏—Ä–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç -90 –¥–æ 90', 'error');
                return;
            }
            
            if (lng < -180 || lng > 180) {
                showStatus('‚ùå –î–æ–ª–≥–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç -180 –¥–æ 180', 'error');
                return;
            }
            
            currentLocation = { lat, lng, name: '–†—É—á–Ω–æ–π –≤–≤–æ–¥' };
            
            coords.innerHTML = `
                ‚úèÔ∏è –†—É—á–Ω–æ–π –≤–≤–æ–¥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç<br>
                –®–∏—Ä–æ—Ç–∞: ${lat.toFixed(6)}<br>
                –î–æ–ª–≥–æ—Ç–∞: ${lng.toFixed(6)}<br>
                –ò—Å—Ç–æ—á–Ω–∏–∫: –í–≤–µ–¥–µ–Ω–æ –≤—Ä—É—á–Ω—É—é
            `;
            
            showStatus('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            addMarkerBtn.disabled = false;
        }

        // –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å GPS
        function tryGPS() {
            if (!navigator.geolocation) {
                showStatus('‚ùå GPS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
                return;
            }

            showStatus('üîç –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å GPS...', 'warning');

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    currentLocation = { lat: latitude, lng: longitude, name: 'GPS' };
                    
                    coords.innerHTML = `
                        üéØ GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã<br>
                        –®–∏—Ä–æ—Ç–∞: ${latitude.toFixed(6)}<br>
                        –î–æ–ª–≥–æ—Ç–∞: ${longitude.toFixed(6)}<br>
                        –¢–æ—á–Ω–æ—Å—Ç—å: ¬±${accuracy.toFixed(0)}–º
                    `;
                    
                    latInput.value = latitude;
                    lngInput.value = longitude;
                    
                    showStatus('üéâ GPS —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                    addMarkerBtn.disabled = false;
                },
                (error) => {
                    showStatus('‚ùå GPS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥.', 'error');
                },
                {
                    enableHighAccuracy: false,
                    timeout: 10000,
                    maximumAge: 600000
                }
            );
        }

        // –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ä
        function addMarker() {
            if (!currentLocation) return;
            
            markers.push({...currentLocation});
            updateMarkerDisplay();
            
            if (markers.length >= 3) {
                calculateBtn.disabled = false;
            }
            
            showStatus(`‚úÖ –ú–∞—Ä–∫–µ—Ä ${markers.length} –¥–æ–±–∞–≤–ª–µ–Ω`, 'success');
        }

        // –û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã
        function clearMarkers() {
            markers = [];
            calculatedArea = 0;
            updateMarkerDisplay();
            result.innerHTML = '';
            calculateBtn.disabled = true;
            saveBtn.disabled = true;
            showStatus('üóëÔ∏è –í—Å–µ –º–∞—Ä–∫–µ—Ä—ã –æ—á–∏—â–µ–Ω—ã', 'info');
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
        function updateMarkerDisplay() {
            markerCount.textContent = markers.length;
            mapMarkerCount.textContent = markers.length;
            
            markerList.innerHTML = '';
            markers.forEach((marker, index) => {
                const div = document.createElement('div');
                div.className = 'marker';
                div.innerHTML = `
                    –ú–∞—Ä–∫–µ—Ä ${index + 1}: ${marker.lat.toFixed(6)}, ${marker.lng.toFixed(6)}<br>
                    <small>–ò—Å—Ç–æ—á–Ω–∏–∫: ${marker.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</small>
                `;
                markerList.appendChild(div);
            });
        }

        // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–ª–æ—â–∞–¥—å
        function calculateArea() {
            if (markers.length < 3) {
                showStatus('‚ùå –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 –º–∞—Ä–∫–µ—Ä–∞', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑—É–º–Ω—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
            const maxDistance = getMaxDistance(markers);
            if (maxDistance > 100000) { // 100 –∫–º
                showStatus('‚ö†Ô∏è –¢–æ—á–∫–∏ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞', 'warning');
                result.innerHTML = `
                    <div style="background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; border-radius: 8px; color: #92400e;">
                        <strong>‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:</strong> –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏: ${(maxDistance/1000).toFixed(1)} –∫–º<br>
                        –î–ª—è —Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—á–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ (–¥–æ 10 –∫–º).<br>
                        <strong>–¢–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–º!</strong>
                    </div>
                `;
                return;
            }
            
            // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è –º–∞–ª—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤
            let area = 0;
            const n = markers.length;
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É –∫–∞–∫ —Ü–µ–Ω—Ç—Ä –¥–ª—è –ø—Ä–æ–µ–∫—Ü–∏–∏
            const centerLat = markers[0].lat * Math.PI / 180;
            const cosCenter = Math.cos(centerLat);
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–µ—Ç—Ä—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞
            const points = markers.map(marker => {
                const lat = marker.lat * Math.PI / 180;
                const lng = marker.lng * Math.PI / 180;
                const centerLng = markers[0].lng * Math.PI / 180;
                
                return {
                    x: (lng - centerLng) * 6378137 * cosCenter,
                    y: (lat - centerLat) * 6378137
                };
            });
            
            // –§–æ—Ä–º—É–ª–∞ –®–æ–π–µ—Ä–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ –ø–æ–ª–∏–≥–æ–Ω–∞
            for (let i = 0; i < n; i++) {
                const j = (i + 1) % n;
                area += points[i].x * points[j].y;
                area -= points[j].x * points[i].y;
            }
            
            area = Math.abs(area) / 2;
            
            const areaSotkas = area / 100;
            const areaHectares = area / 10000;
            calculatedArea = area;
            
            result.innerHTML = `
                <div class="success">
                    <strong>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞:</strong><br>
                    –ü–ª–æ—â–∞–¥—å: ${area.toFixed(1)} –º¬≤<br>
                    –í —Å–æ—Ç–∫–∞—Ö: ${areaSotkas.toFixed(2)} —Å–æ—Ç–æ–∫<br>
                    –í –≥–µ–∫—Ç–∞—Ä–∞—Ö: ${areaHectares.toFixed(4)} –≥–∞<br>
                    –ú–∞—Ä–∫–µ—Ä–æ–≤: ${markers.length}<br>
                    <small>–ú–∞–∫—Å. —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${(maxDistance/1000).toFixed(1)} –∫–º</small>
                </div>
                <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 11px;">
                    <strong>üîç –û—Ç–ª–∞–¥–∫–∞:</strong><br>
                    ${points.map((p, i) => `–¢–æ—á–∫–∞ ${i+1}: x=${p.x.toFixed(1)}–º, y=${p.y.toFixed(1)}–º`).join('<br>')}
                </div>
            `;
            
            saveBtn.disabled = false;
            showStatus('‚úÖ –ü–ª–æ—â–∞–¥—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞', 'success');
        }

        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
        function checkRectangle(markers) {
            if (markers.length !== 4) return null;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ—Ä–æ–Ω—ã
            const side1 = getDistance(markers[0], markers[1]);
            const side2 = getDistance(markers[1], markers[2]);
            const side3 = getDistance(markers[2], markers[3]);
            const side4 = getDistance(markers[3], markers[0]);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–≥–æ–Ω–∞–ª–∏
            const diag1 = getDistance(markers[0], markers[2]);
            const diag2 = getDistance(markers[1], markers[3]);
            
            return {
                sides: [side1, side2, side3, side4],
                diagonals: [diag1, diag2],
                area: side1 * side2 // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
            };
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
        function getMaxDistance(points) {
            let maxDist = 0;
            for (let i = 0; i < points.length; i++) {
                for (let j = i + 1; j < points.length; j++) {
                    const dist = getDistance(points[i], points[j]);
                    if (dist > maxDist) maxDist = dist;
                }
            }
            return maxDist;
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ (—Ñ–æ—Ä–º—É–ª–∞ –•–∞–≤–µ—Ä—Å–∏–Ω–∞)
        function getDistance(point1, point2) {
            const R = 6378137; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
            const lat1 = point1.lat * Math.PI / 180;
            const lat2 = point2.lat * Math.PI / 180;
            const deltaLat = (point2.lat - point1.lat) * Math.PI / 180;
            const deltaLng = (point2.lng - point1.lng) * Math.PI / 180;

            const a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +
                     Math.cos(lat1) * Math.cos(lat2) *
                     Math.sin(deltaLng/2) * Math.sin(deltaLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c;
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏–µ
        function saveMeasurement() {
            const name = saveName.value || `–ò–∑–º–µ—Ä–µ–Ω–∏–µ ${new Date().toLocaleDateString()}`;
            
            const measurement = {
                id: Date.now(),
                name: name,
                area: calculatedArea,
                sotkas: calculatedArea / 100,
                hectares: calculatedArea / 10000,
                markers: markers,
                date: new Date().toISOString()
            };
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
            const measurements = JSON.parse(localStorage.getItem('measurements') || '[]');
            measurements.push(measurement);
            localStorage.setItem('measurements', JSON.stringify(measurements));
            
            saveStatus.innerHTML = '<div class="status status-success">‚úÖ –ò–∑–º–µ—Ä–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!</div>';
            updateHistoryCount();
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            saveName.value = '';
            clearMarkers();
            
            setTimeout(() => {
                saveStatus.innerHTML = '';
            }, 3000);
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –∏—Å—Ç–æ—Ä–∏–∏
        function updateHistoryCount() {
            const measurements = JSON.parse(localStorage.getItem('measurements') || '[]');
            document.getElementById('historyCount').textContent = measurements.length;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            const measurements = JSON.parse(localStorage.getItem('measurements') || '[]');
            
            if (measurements.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #6b7280;">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π</p>';
                historyList.style.display = 'block';
                return;
            }
            
            historyList.innerHTML = '';
            measurements.reverse().forEach(measurement => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div class="actions">
                        <button class="btn-restore" onclick="restoreMeasurement(${measurement.id})">üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        <button class="btn-delete" onclick="deleteMeasurement(${measurement.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    <h4>${measurement.name}</h4>
                    <div class="date">üìÖ ${new Date(measurement.date).toLocaleString('ru-RU')}</div>
                    <div class="area">üìä ${measurement.area.toFixed(1)} –º¬≤ (${measurement.sotkas.toFixed(2)} —Å–æ—Ç–æ–∫)</div>
                    <div class="details">
                        üìç –¢–æ—á–µ–∫: ${measurement.markers.length} | 
                        üèûÔ∏è –ì–µ–∫—Ç–∞—Ä: ${measurement.hectares.toFixed(4)} –≥–∞
                    </div>
                `;
                historyList.appendChild(item);
            });
            
            historyList.style.display = historyList.style.display === 'none' ? 'block' : 'none';
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏–µ
        function restoreMeasurement(id) {
            const measurements = JSON.parse(localStorage.getItem('measurements') || '[]');
            const measurement = measurements.find(m => m.id === id);
            
            if (measurement) {
                // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                clearMarkers();
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã
                markers = [...measurement.markers];
                calculatedArea = measurement.area;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateMarkerDisplay();
                calculateBtn.disabled = false;
                
                result.innerHTML = `
                    <div class="success">
                        <strong>üìä –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ${measurement.name}</strong><br>
                        –ü–ª–æ—â–∞–¥—å: ${measurement.area.toFixed(1)} –º¬≤<br>
                        –í —Å–æ—Ç–∫–∞—Ö: ${measurement.sotkas.toFixed(2)} —Å–æ—Ç–æ–∫<br>
                        –í –≥–µ–∫—Ç–∞—Ä–∞—Ö: ${measurement.hectares.toFixed(4)} –≥–∞<br>
                        –ú–∞—Ä–∫–µ—Ä–æ–≤: ${measurement.markers.length}
                    </div>
                `;
                
                showStatus('‚úÖ –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                document.getElementById('historyList').style.display = 'none';
            }
        }

        // –£–¥–∞–ª–∏—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏–µ
        function deleteMeasurement(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∏–∑–º–µ—Ä–µ–Ω–∏–µ?')) {
                const measurements = JSON.parse(localStorage.getItem('measurements') || '[]');
                const filtered = measurements.filter(m => m.id !== id);
                localStorage.setItem('measurements', JSON.stringify(filtered));
                
                updateHistoryCount();
                loadHistory(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                showStatus('üóëÔ∏è –ò–∑–º–µ—Ä–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'info');
            }
        }

        // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é
        function clearHistory() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–Æ –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ—Ä–µ–Ω–∏–π? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                localStorage.removeItem('measurements');
                updateHistoryCount();
                document.getElementById('historyList').innerHTML = '';
                document.getElementById('historyList').style.display = 'none';
                showStatus('üóëÔ∏è –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞', 'warning');
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportHistory() {
            const measurements = JSON.parse(localStorage.getItem('measurements') || '[]');
            
            if (measurements.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                return;
            }
            
            let csvContent = '–ù–∞–∑–≤–∞–Ω–∏–µ,–î–∞—Ç–∞,–ü–ª–æ—â–∞–¥—å_–º2,–°–æ—Ç–∫–∏,–ì–µ–∫—Ç–∞—Ä—ã,–¢–æ—á–µ–∫,–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\n';
            
            measurements.forEach(m => {
                const coords = m.markers.map(marker => `${marker.lat},${marker.lng}`).join(';');
                csvContent += `"${m.name}","${new Date(m.date).toLocaleString('ru-RU')}",${m.area.toFixed(1)},${m.sotkas.toFixed(2)},${m.hectares.toFixed(4)},${m.markers.length},"${coords}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `zemljemer_history_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showStatus('üì• –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function goToHome() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏–π
            showNavigationDialog();
        }

        function showNavigationDialog() {
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 1000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            dialog.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 90%; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <h2 style="margin: 0 0 15px 0; color: #333;">üè† –ù–∞–≤–∏–≥–∞—Ü–∏—è</h2>
                    <p style="margin: 15px 0; color: #666;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</p>
                    
                    <button onclick="openMainApp()" style="width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px; background: #10b981; color: white; cursor: pointer; font-weight: bold;">
                        üöÄ –û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    </button>
                    
                    <button onclick="showOtherModes()" style="width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px; background: #2563eb; color: white; cursor: pointer; font-weight: bold;">
                        üõ†Ô∏è –î—Ä—É–≥–∏–µ —Ä–µ–∂–∏–º—ã
                    </button>
                    
                    <button onclick="location.reload()" style="width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px; background: #f59e0b; color: white; cursor: pointer; font-weight: bold;">
                        üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    </button>
                    
                    <button onclick="closeDialog()" style="width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px; background: #6b7280; color: white; cursor: pointer; font-weight: bold;">
                        ‚ùå –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            `;
            
            document.body.appendChild(dialog);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –¥–∏–∞–ª–æ–≥–∞
            dialog.addEventListener('click', (e) => {
                if (e.target === dialog) {
                    closeDialog();
                }
            });
        }

        function openMainApp() {
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Ç–∞–∫ –∫–∞–∫ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
            showAppInstructions();
        }

        function showOtherModes() {
            closeDialog();
            const modesDialog = document.createElement('div');
            modesDialog.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 1000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            modesDialog.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 90%; text-align: center;">
                    <h2 style="margin: 0 0 15px 0; color: #333;">üõ†Ô∏è –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã</h2>
                    
                    <button onclick="window.location.href='manual-mode.html'" style="width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px; background: #10b981; color: white; cursor: pointer; font-weight: bold;">
                        ‚úèÔ∏è –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º (—Ç–µ–∫—É—â–∏–π)
                    </button>
                    
                    <button onclick="openTestMode()" style="width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px; background: #f59e0b; color: white; cursor: pointer; font-weight: bold;">
                        üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
                    </button>
                    
                    <button onclick="openGpsMode()" style="width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px; background: #ef4444; color: white; cursor: pointer; font-weight: bold;">
                        üìç GPS —Ä–µ–∂–∏–º (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)
                    </button>
                    
                    <button onclick="closeModeDialog()" style="width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px; background: #6b7280; color: white; cursor: pointer; font-weight: bold;">
                        ‚Ü©Ô∏è –ù–∞–∑–∞–¥
                    </button>
                </div>
            `;
            
            document.body.appendChild(modesDialog);
            
            window.openTestMode = function() {
                window.location.href = 'test-coordinates.html';
            };
            
            window.openGpsMode = function() {
                alert('GPS —Ä–µ–∂–∏–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Å–∏—Å—Ç–µ–º–æ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º.');
            };
            
            window.closeModeDialog = function() {
                modesDialog.remove();
                showNavigationDialog();
            };
        }

        function showAppInstructions() {
            closeDialog();
            const instructionsDialog = document.createElement('div');
            instructionsDialog.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 1000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            instructionsDialog.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 90%; text-align: left;">
                    <h2 style="margin: 0 0 15px 0; color: #333; text-align: center;">üì± –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h2>
                    
                    <div style="font-size: 14px; line-height: 1.6; color: #555;">
                        <p><strong>üîß –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –Ω—É–∂–Ω–æ:</strong></p>
                        <p>‚Ä¢ –ó–∞–ø—É—Å—Ç–∏—Ç—å React-—Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</p>
                        <p>‚Ä¢ –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å APK-—Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
                        
                        <hr style="margin: 15px 0; border: 1px solid #eee;">
                        
                        <p><strong>üì± –ü–æ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ:</strong></p>
                        <p>‚úÖ –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º –∏–∑–º–µ—Ä–µ–Ω–∏—è (—Ç–µ–∫—É—â–∏–π)</p>
                        <p>‚úÖ –†–∞—Å—á–µ—Ç –ø–ª–æ—â–∞–¥–∏ —É—á–∞—Å—Ç–∫–æ–≤</p>
                        <p>‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
                        <p>‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</p>
                        
                        <hr style="margin: 15px 0; border: 1px solid #eee;">
                        
                        <p><strong>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong></p>
                        <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—É—â–∏–π —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º - –æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω!</p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 16px; background: #10b981; color: white; cursor: pointer; font-weight: bold;">
                            ‚úÖ –û—Å—Ç–∞—Ç—å—Å—è –≤ —Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ
                        </button>
                        <button onclick="window.open('quick-apk.html', '_blank')" style="flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 16px; background: #2563eb; color: white; cursor: pointer; font-weight: bold;">
                            üì± –°–æ–∑–¥–∞—Ç—å APK
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(instructionsDialog);
        }

        function showCreateAPKDialog() {
            closeDialog();
            const apkDialog = document.createElement('div');
            apkDialog.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 1000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            apkDialog.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 90%; text-align: center;">
                    <h2 style="margin: 0 0 15px 0; color: #333;">üì± –°–æ–∑–¥–∞–Ω–∏–µ APK</h2>
                    
                    <p style="margin: 15px 0; color: #666;">–•–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è?</p>
                    
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: left; font-size: 14px;">
                        <strong>APK –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å:</strong><br>
                        ‚Ä¢ –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è<br>
                        ‚Ä¢ GPS –∏ —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º—ã<br>
                        ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö<br>
                        ‚Ä¢ –†–∞–±–æ—Ç—É –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="startAPKCreation()" style="flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 16px; background: #10b981; color: white; cursor: pointer; font-weight: bold;">
                            üöÄ –î–∞, —Å–æ–∑–¥–∞—Ç—å APK
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 16px; background: #6b7280; color: white; cursor: pointer; font-weight: bold;">
                            ‚ùå –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(apkDialog);
        }

        function startAPKCreation() {
            alert('üöß –°–æ–∑–¥–∞–Ω–∏–µ APK –∑–∞–ø—É—â–µ–Ω–æ!\n\n–≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç...\n–û–∂–∏–¥–∞–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –≤ –∫–æ–Ω—Å–æ–ª–∏.');
            closeDialog();
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è APK
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.showCreateAPKDialog = showCreateAPKDialog;
        window.startAPKCreation = startAPKCreation;

        function closeDialog() {
            const dialogs = document.querySelectorAll('div[style*="position: fixed"]');
            dialogs.forEach(dialog => {
                if (dialog.style.zIndex === '1000') {
                    dialog.remove();
                }
            });
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        window.openMainApp = openMainApp;
        window.showOtherModes = showOtherModes;
        window.closeDialog = closeDialog;

        function showHomeOptions() {
            const homeDialog = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;" onclick="this.remove()">
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 90%; text-align: center;" onclick="event.stopPropagation()">
                        <h2>üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
                        <p style="margin: 15px 0;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</p>
                        <button onclick="location.reload()" style="width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 8px; font-size: 16px; background: #10b981; color: white; cursor: pointer;">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
                        <button onclick="window.history.back()" style="width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 8px; font-size: 16px; background: #6b7280; color: white; cursor: pointer;">‚Ü©Ô∏è –ù–∞–∑–∞–¥</button>
                        <button onclick="this.parentElement.parentElement.remove()" style="width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 8px; font-size: 16px; background: #ef4444; color: white; cursor: pointer;">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', homeDialog);
        }

        // –°–æ–±—ã—Ç–∏—è
        document.getElementById('moscowBtn').addEventListener('click', () => setPlace(places.moscow));
        document.getElementById('spbBtn').addEventListener('click', () => setPlace(places.spb));
        document.getElementById('nskBtn').addEventListener('click', () => setPlace(places.nsk));
        document.getElementById('currentBtn').addEventListener('click', tryGPS);
        document.getElementById('setManualBtn').addEventListener('click', setManualCoords);
        document.getElementById('addMarkerBtn').addEventListener('click', addMarker);
        document.getElementById('clearBtn').addEventListener('click', clearMarkers);
        document.getElementById('calculateBtn').addEventListener('click', calculateArea);
        document.getElementById('saveBtn').addEventListener('click', saveMeasurement);
        document.getElementById('loadHistoryBtn').addEventListener('click', loadHistory);
        document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
        document.getElementById('exportHistoryBtn').addEventListener('click', exportHistory);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            showStatus('üìç –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –≤–≤–æ–¥–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç', 'info');
            updateHistoryCount();
        });
    </script>
</body>
</html>
